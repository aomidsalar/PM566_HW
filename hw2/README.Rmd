---
title: "Assignment 2"
author: "Audrey Omidsalar"
date: "10/8/2021"
output:
  html_document:
    toc: yes
    toc_float: yes
    keep_md: yes
  github_document:
  always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('data.table')
library('dtplyr')
library('dplyr')
```

## Download Data

```{r download data, cache = TRUE}
if (!file.exists("chs_individual.csv"))
  download.file(
    url = "https://raw.githubusercontent.com/USCbiostats/data-science-data/master/01_chs/chs_individual.csv",
    destfile = "chs_individual.csv",
    method   = "libcurl",
    timeout  = 60
  )
individual <- data.table::fread("chs_individual.csv")

if (!file.exists("chs_regional.csv"))
  download.file(
    url = "https://raw.githubusercontent.com/USCbiostats/data-science-data/master/01_chs/chs_regional.csv",
    destfile = "chs_regional.csv",
    method   = "libcurl",
    timeout  = 60
  )
regional <- data.table::fread("chs_regional.csv")
```

### Merge the Data
```{r merge}
merged <- merge(
  # Data
  x     = individual,      
  y     = regional, 
  by  = "townname",
  all.x = TRUE,      
  all.y = FALSE
)
```

### Check number of rows
```{r}
dim(individual)
dim(regional)
dim(merged)
```
The `merged` dataset has 1200 rows, which is the same as the `individual` dataset.

### Looking at the `merged` dataset more closely
```{r}
summary(merged)
```

### Imputing missing variables
Some of the variables that will be used later have NA values. These will be replaced by the averages within the `hispanic` and `male` variables
```{r}
merged[, bmi := fcoalesce(bmi, mean(bmi, na.rm = TRUE)),
    by = .(male, hispanic)]
merged[, fev := fcoalesce(fev, mean(fev, na.rm = TRUE)),
    by = .(male, hispanic)]
#merged[, smoke := fcoalesce(smoke, mean(smoke, na.rm = TRUE)),
#       by = .(male, hispanic)]
#merged[, gasstove := fcoalesce(gasstove, mean(gasstove, na.rm = TRUE)),
#       by = .(male, hispanic)]
```

### Creating new variable `obesity_level` 
```{r}
merged[, obesity_level := fifelse(bmi < 14, "underweight",
                                  fifelse(bmi < 22, "normal",
                                        fifelse(bmi < 24, "overweight", "obese")))] 
##Summary Table
bmi_summary <- merged[, .(
  min_bmi = min(bmi),
  max_bmi = max(bmi),
  N_obs   = .N),
  by = "obesity_level"]
knitr::kable(bmi_summary)
```

